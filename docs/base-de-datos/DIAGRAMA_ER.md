# ğŸ—„ï¸ Diagrama Entidad-RelaciÃ³n (ER)

## ğŸ“‹ Ãndice

- [Diagrama General](#diagrama-general)
- [Entidades Principales](#entidades-principales)
- [Relaciones](#relaciones)
- [Ãndices y Optimizaciones](#Ã­ndices-y-optimizaciones)

## ğŸ”· Diagrama General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MÃ“DULO DE USUARIOS Y AUTH                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚    roles     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”‚  permissions â”‚
â”‚              â”‚   M:M   â”‚              â”‚   M:M   â”‚              â”‚
â”‚ - id (PK)    â”‚         â”‚ - id (PK)    â”‚         â”‚ - id (PK)    â”‚
â”‚ - email      â”‚         â”‚ - name       â”‚         â”‚ - name       â”‚
â”‚ - password   â”‚         â”‚ - desc       â”‚         â”‚ - resource   â”‚
â”‚ - full_name  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - action     â”‚
â”‚ - phone      â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - role_id(FK)â”‚
â”‚ - status     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - created_at â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  user_addresses  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    1:N  â”‚                  â”‚
                         â”‚ - id (PK)        â”‚
                         â”‚ - user_id (FK)   â”‚
                         â”‚ - street         â”‚
                         â”‚ - city           â”‚
                         â”‚ - lat/lng        â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MÃ“DULO DE PRODUCTOS Y MENÃš                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ categories   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”‚  products    â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚recipe_items  â”‚
â”‚              â”‚   1:N   â”‚              â”‚   1:N   â”‚              â”‚
â”‚ - id (PK)    â”‚         â”‚ - id (PK)    â”‚         â”‚ - id (PK)    â”‚
â”‚ - name       â”‚         â”‚ - name       â”‚         â”‚ - product_id â”‚
â”‚ - desc       â”‚         â”‚ - desc       â”‚         â”‚ - ingredient â”‚
â”‚ - parent_id  â”‚         â”‚ - price      â”‚         â”‚ - quantity   â”‚
â”‚ - image_url  â”‚         â”‚ - category_idâ”‚         â”‚ - unit       â”‚
â”‚ - active     â”‚         â”‚ - image_url  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - prep_time  â”‚                â†“
                         â”‚ - available  â”‚                â†“
                         â”‚ - stock_qty  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ ingredients  â”‚
                                 â†“                â”‚              â”‚
                                 â†“                â”‚ - id (PK)    â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ - name       â”‚
                         â”‚product_addonsâ”‚         â”‚ - stock_qty  â”‚
                         â”‚              â”‚         â”‚ - unit       â”‚
                         â”‚ - id (PK)    â”‚         â”‚ - min_stock  â”‚
                         â”‚ - product_id â”‚         â”‚ - cost       â”‚
                         â”‚ - name       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ - price      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MÃ“DULO DE PEDIDOS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   orders     â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ order_items  â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  products    â”‚
â”‚              â”‚   1:N   â”‚              â”‚   N:1   â”‚              â”‚
â”‚ - id (PK)    â”‚         â”‚ - id (PK)    â”‚         â”‚ (ver arriba) â”‚
â”‚ - order_num  â”‚         â”‚ - order_id   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - customer_idâ”‚         â”‚ - product_id â”‚
â”‚ - table_id   â”‚         â”‚ - quantity   â”‚
â”‚ - status     â”‚         â”‚ - unit_price â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - type       â”‚         â”‚ - subtotal   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚order_item_   â”‚
â”‚ - subtotal   â”‚         â”‚ - notes      â”‚   1:N   â”‚   addons     â”‚
â”‚ - tax        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚              â”‚
â”‚ - total      â”‚                                  â”‚ - id (PK)    â”‚
â”‚ - notes      â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ - item_id    â”‚
â”‚ - created_at â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚order_timelineâ”‚         â”‚ - addon_id   â”‚
â”‚ - updated_at â”‚   1:N   â”‚              â”‚         â”‚ - price      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - id (PK)    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                 â”‚ - order_id   â”‚
       â†“                 â”‚ - status     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ - timestamp  â”‚
â”‚   tables     â”‚         â”‚ - user_id    â”‚
â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - id (PK)    â”‚
â”‚ - table_num  â”‚
â”‚ - seats      â”‚
â”‚ - zone       â”‚
â”‚ - status     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MÃ“DULO DE FACTURACIÃ“N                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   invoices   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚invoice_items â”‚
â”‚              â”‚   1:N   â”‚              â”‚
â”‚ - id (PK)    â”‚         â”‚ - id (PK)    â”‚
â”‚ - invoice_numâ”‚         â”‚ - invoice_id â”‚
â”‚ - order_id   â”‚         â”‚ - desc       â”‚
â”‚ - customer_idâ”‚         â”‚ - quantity   â”‚
â”‚ - subtotal   â”‚         â”‚ - unit_price â”‚
â”‚ - tax_amount â”‚         â”‚ - total      â”‚
â”‚ - discount   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - total      â”‚
â”‚ - status     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - issued_at  â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚tax_details   â”‚
â”‚ - paid_at    â”‚   1:N   â”‚              â”‚
â”‚ - void_reasonâ”‚         â”‚ - id (PK)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - invoice_id â”‚
       â†“                 â”‚ - tax_name   â”‚
       â†“                 â”‚ - tax_rate   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ - tax_amount â”‚
â”‚credit_notes  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚
â”‚ - id (PK)    â”‚
â”‚ - invoice_id â”‚
â”‚ - reason     â”‚
â”‚ - amount     â”‚
â”‚ - created_at â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MÃ“DULO DE PAGOS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   payments   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚payment_methods   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   refunds    â”‚
â”‚              â”‚   N:1   â”‚                  â”‚   1:N   â”‚              â”‚
â”‚ - id (PK)    â”‚         â”‚ - id (PK)        â”‚         â”‚ - id (PK)    â”‚
â”‚ - order_id   â”‚         â”‚ - name           â”‚         â”‚ - payment_id â”‚
â”‚ - invoice_id â”‚         â”‚ - type           â”‚         â”‚ - amount     â”‚
â”‚ - amount     â”‚         â”‚ - provider       â”‚         â”‚ - reason     â”‚
â”‚ - method_id  â”‚         â”‚ - config         â”‚         â”‚ - status     â”‚
â”‚ - status     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - created_at â”‚
â”‚ - gateway_id â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - gateway    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - metadata   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚payment_splits    â”‚
â”‚ - created_at â”‚   1:N   â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - id (PK)        â”‚
                         â”‚ - payment_id     â”‚
                         â”‚ - method_id      â”‚
                         â”‚ - amount         â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MÃ“DULO DE DELIVERY                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ deliveries   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   drivers    â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚driver_locations  â”‚
â”‚              â”‚   N:1   â”‚              â”‚   1:N   â”‚                  â”‚
â”‚ - id (PK)    â”‚         â”‚ - id (PK)    â”‚         â”‚ - id (PK)        â”‚
â”‚ - order_id   â”‚         â”‚ - user_id    â”‚         â”‚ - driver_id      â”‚
â”‚ - driver_id  â”‚         â”‚ - vehicle_id â”‚         â”‚ - lat            â”‚
â”‚ - zone_id    â”‚         â”‚ - status     â”‚         â”‚ - lng            â”‚
â”‚ - status     â”‚         â”‚ - rating     â”‚         â”‚ - timestamp      â”‚
â”‚ - pickup_timeâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - delivered  â”‚                â†“
â”‚ - distance   â”‚                â†“
â”‚ - fee        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - created_at â”‚         â”‚   vehicles   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚              â”‚
       â†“                 â”‚ - id (PK)    â”‚
       â†“                 â”‚ - plate      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ - type       â”‚
â”‚delivery_zonesâ”‚         â”‚ - model      â”‚
â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - id (PK)    â”‚
â”‚ - name       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - polygon    â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚delivery_timeline â”‚
â”‚ - base_fee   â”‚   1:N   â”‚                  â”‚
â”‚ - per_km_fee â”‚         â”‚ - id (PK)        â”‚
â”‚ - active     â”‚         â”‚ - delivery_id    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - status         â”‚
                         â”‚ - lat/lng        â”‚
                         â”‚ - timestamp      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MÃ“DULO DE NOTIFICACIONES                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  notifications   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚notification_templatesâ”‚
â”‚                  â”‚   N:1   â”‚                      â”‚
â”‚ - id (PK)        â”‚         â”‚ - id (PK)            â”‚
â”‚ - user_id        â”‚         â”‚ - name               â”‚
â”‚ - template_id    â”‚         â”‚ - channel            â”‚
â”‚ - channel        â”‚         â”‚ - subject            â”‚
â”‚ - recipient      â”‚         â”‚ - body_template      â”‚
â”‚ - subject        â”‚         â”‚ - variables          â”‚
â”‚ - body           â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - status         â”‚
â”‚ - sent_at        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - error          â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚notification_prefs    â”‚
â”‚ - created_at     â”‚   N:1   â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - id (PK)            â”‚
                             â”‚ - user_id            â”‚
                             â”‚ - channel            â”‚
                             â”‚ - enabled            â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MÃ“DULO DE INVENTARIO                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ingredients  â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚inventory_movementâ”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  suppliers   â”‚
â”‚              â”‚   1:N   â”‚                  â”‚   N:1   â”‚              â”‚
â”‚ (ver arriba) â”‚         â”‚ - id (PK)        â”‚         â”‚ - id (PK)    â”‚
â”‚              â”‚         â”‚ - ingredient_id  â”‚         â”‚ - name       â”‚
â”‚              â”‚         â”‚ - type           â”‚         â”‚ - contact    â”‚
â”‚              â”‚         â”‚ - quantity       â”‚         â”‚ - email      â”‚
â”‚              â”‚         â”‚ - unit_cost      â”‚         â”‚ - phone      â”‚
â”‚              â”‚         â”‚ - supplier_id    â”‚         â”‚ - rating     â”‚
â”‚              â”‚         â”‚ - reference      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚         â”‚ - notes          â”‚
â”‚              â”‚         â”‚ - created_at     â”‚
â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚
â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚purchase_orders   â”‚
â”‚              â”‚   N:1   â”‚                  â”‚
â”‚              â”‚         â”‚ - id (PK)        â”‚
â”‚              â”‚         â”‚ - supplier_id    â”‚
â”‚              â”‚         â”‚ - status         â”‚
â”‚              â”‚         â”‚ - total          â”‚
â”‚              â”‚         â”‚ - expected_date  â”‚
â”‚              â”‚         â”‚ - received_date  â”‚
â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MÃ“DULO DE LEALTAD                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚loyalty_accounts  â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚loyalty_trans     â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚loyalty_tiers â”‚
â”‚                  â”‚   1:N   â”‚                  â”‚   N:1   â”‚              â”‚
â”‚ - id (PK)        â”‚         â”‚ - id (PK)        â”‚         â”‚ - id (PK)    â”‚
â”‚ - user_id        â”‚         â”‚ - account_id     â”‚         â”‚ - name       â”‚
â”‚ - tier_id        â”‚         â”‚ - type           â”‚         â”‚ - min_points â”‚
â”‚ - points         â”‚         â”‚ - points         â”‚         â”‚ - multiplier â”‚
â”‚ - lifetime_pts   â”‚         â”‚ - order_id       â”‚         â”‚ - benefits   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - description    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                     â”‚ - created_at     â”‚
       â†“                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚loyalty_rewards   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚reward_redemptionsâ”‚
â”‚ - id (PK)        â”‚   1:N   â”‚                  â”‚
â”‚ - name           â”‚         â”‚ - id (PK)        â”‚
â”‚ - points_cost    â”‚         â”‚ - reward_id      â”‚
â”‚ - type           â”‚         â”‚ - account_id     â”‚
â”‚ - value          â”‚         â”‚ - order_id       â”‚
â”‚ - valid_from     â”‚         â”‚ - redeemed_at    â”‚
â”‚ - valid_until    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MÃ“DULO DE RESERVACIONES                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  reservations    â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   tables     â”‚
â”‚                  â”‚   N:1   â”‚              â”‚
â”‚ - id (PK)        â”‚         â”‚ (ver arriba) â”‚
â”‚ - customer_id    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - table_id       â”‚
â”‚ - party_size     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - date           â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚reservation_slots â”‚
â”‚ - time_slot      â”‚   N:1   â”‚                  â”‚
â”‚ - status         â”‚         â”‚ - id (PK)        â”‚
â”‚ - notes          â”‚         â”‚ - day_of_week    â”‚
â”‚ - reminded       â”‚         â”‚ - time_start     â”‚
â”‚ - created_at     â”‚         â”‚ - time_end       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - max_capacity   â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MÃ“DULO DE PERSONAL                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  employees   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   shifts     â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚shift_assignments â”‚
â”‚              â”‚   1:N   â”‚              â”‚   1:N   â”‚                  â”‚
â”‚ - id (PK)    â”‚         â”‚ - id (PK)    â”‚         â”‚ - id (PK)        â”‚
â”‚ - user_id    â”‚         â”‚ - name       â”‚         â”‚ - shift_id       â”‚
â”‚ - position   â”‚         â”‚ - start_time â”‚         â”‚ - employee_id    â”‚
â”‚ - hire_date  â”‚         â”‚ - end_time   â”‚         â”‚ - date           â”‚
â”‚ - salary     â”‚         â”‚ - day_of_weekâ”‚         â”‚ - checked_in     â”‚
â”‚ - status     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - checked_out    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ - hours_worked   â”‚
       â†“                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚commissions   â”‚         â”‚employee_reviews  â”‚
â”‚              â”‚         â”‚                  â”‚
â”‚ - id (PK)    â”‚         â”‚ - id (PK)        â”‚
â”‚ - employee_idâ”‚         â”‚ - employee_id    â”‚
â”‚ - order_id   â”‚         â”‚ - reviewer_id    â”‚
â”‚ - amount     â”‚         â”‚ - rating         â”‚
â”‚ - period     â”‚         â”‚ - comments       â”‚
â”‚ - paid       â”‚         â”‚ - review_date    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MÃ“DULO DE ANALYTICS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sales_reports   â”‚         â”‚ product_metrics  â”‚
â”‚                  â”‚         â”‚                  â”‚
â”‚ - id (PK)        â”‚         â”‚ - id (PK)        â”‚
â”‚ - date           â”‚         â”‚ - product_id     â”‚
â”‚ - total_sales    â”‚         â”‚ - date           â”‚
â”‚ - order_count    â”‚         â”‚ - units_sold     â”‚
â”‚ - avg_ticket     â”‚         â”‚ - revenue        â”‚
â”‚ - period_type    â”‚         â”‚ - cost           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - profit         â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

## ğŸ”— Relaciones Clave

### 1. Users â†’ Orders (1:N)
Un usuario puede tener mÃºltiples pedidos

### 2. Orders â†’ Order_Items (1:N)
Un pedido contiene mÃºltiples Ã­tems

### 3. Products â†’ Order_Items (1:N)
Un producto puede estar en mÃºltiples pedidos

### 4. Orders â†’ Invoices (1:1)
Cada pedido genera una factura

### 5. Orders â†’ Deliveries (1:1)
Cada pedido de delivery tiene un registro de entrega

### 6. Deliveries â†’ Drivers (N:1)
Un repartidor puede tener mÃºltiples entregas

### 7. Products â†’ Recipe_Items â†’ Ingredients (N:M)
RelaciÃ³n muchos a muchos entre productos e ingredientes a travÃ©s de recetas

### 8. Users â†’ Loyalty_Accounts (1:1)
Cada usuario tiene una cuenta de lealtad

## ğŸ“Š Ãndices y Optimizaciones

### Ãndices CrÃ­ticos

```sql
-- Orders
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created_at ON orders(created_at DESC);

-- Order Items
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);

-- Deliveries
CREATE INDEX idx_deliveries_driver_id ON deliveries(driver_id);
CREATE INDEX idx_deliveries_status ON deliveries(status);

-- Payments
CREATE INDEX idx_payments_order_id ON payments(order_id);
CREATE INDEX idx_payments_status ON payments(status);

-- Notifications
CREATE INDEX idx_notifications_user_id ON notifications(user_id);
CREATE INDEX idx_notifications_status ON notifications(status);
```

### Ãndices Compuestos

```sql
-- Para bÃºsquedas frecuentes
CREATE INDEX idx_orders_customer_status ON orders(customer_id, status);
CREATE INDEX idx_deliveries_driver_status ON deliveries(driver_id, status);
```

### Ãndices de Texto Completo

```sql
-- Para bÃºsqueda de productos
CREATE INDEX idx_products_search ON products USING gin(to_tsvector('spanish', name || ' ' || description));
```

---

Ver [Esquemas Detallados](./ESQUEMAS.md) para definiciones SQL completas.
